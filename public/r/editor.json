{
  "name": "editor",
  "version": "0.0.0",
  "description": "Minimal Tiptap React editor component",
  "files": [
    {
      "path": "core/editor.tsx",
      "content": "import '../styles/editor.css';\r\n\r\nimport { EditorContent, EditorContext, useEditor } from '@tiptap/react';\r\n\r\nimport { EditorExtensions } from '../extensions/editor';\r\nimport { FixedToolbar } from '../ui/fixed-toolbar';\r\n\r\nexport interface EditorProps {\r\n\tcontent?: string;\r\n\tonChange?: (content: string) => void;\r\n}\r\n\r\nexport function Editor({ content = '', onChange }: EditorProps) {\r\n\tconst editor = useEditor({\r\n\t\tcontent,\r\n\t\teditable: true,\r\n\t\textensions: EditorExtensions,\r\n\t\tonUpdate: ({ editor }) => onChange?.(editor.getHTML())\r\n\t});\r\n\r\n\treturn (\r\n\t\t<EditorContext.Provider value={{ editor }}>\r\n\t\t\t<div className=\"notra-editor\">\r\n\t\t\t\t<FixedToolbar />\r\n\t\t\t\t<EditorContent editor={editor} />\r\n\t\t\t</div>\r\n\t\t</EditorContext.Provider>\r\n\t);\r\n}\r\n"
    },
    {
      "path": "core/viewer.tsx",
      "content": "import '../styles/editor.css';\r\n\r\nimport { JSONContent } from '@tiptap/core';\r\nimport { renderToReactElement } from '@tiptap/static-renderer/pm/react';\r\nimport { JSX } from 'react';\r\n\r\nimport { ViewerExtensions } from '../extensions/viewer';\r\n\r\nexport interface ViewerProps {\r\n\tcontent: JSONContent;\r\n}\r\n\r\nexport function Viewer({ content }: ViewerProps): JSX.Element {\r\n\treturn (\r\n\t\t<div className=\"notra-editor\">\r\n\t\t\t{renderToReactElement({ extensions: ViewerExtensions, content })}\r\n\t\t</div>\r\n\t);\r\n}\r\n"
    },
    {
      "path": "extensions/editor.ts",
      "content": "import { HorizontalRule } from './horizontal-rule';\r\nimport { Starter } from './starter';\r\n\r\nexport const EditorExtensions = [Starter, HorizontalRule];\r\n"
    },
    {
      "path": "extensions/horizontal-rule.ts",
      "content": "import TiptapHorizontalRule from '@tiptap/extension-horizontal-rule';\r\nimport { mergeAttributes } from '@tiptap/react';\r\n\r\n// Wrapper div enables better cursor positioning around the rule\r\nexport const HorizontalRule = TiptapHorizontalRule.extend({\r\n\trenderHTML() {\r\n\t\treturn [\r\n\t\t\t'div',\r\n\t\t\tmergeAttributes(this.options.HTMLAttributes, { 'data-type': this.name }),\r\n\t\t\t['hr']\r\n\t\t];\r\n\t}\r\n});\r\n"
    },
    {
      "path": "extensions/starter.ts",
      "content": "import { StarterKit } from '@tiptap/starter-kit';\n\nexport const Starter = StarterKit.configure({\n\thorizontalRule: false,\n\tcodeBlock: false\n});\n"
    },
    {
      "path": "extensions/viewer.ts",
      "content": "import { HorizontalRule } from './horizontal-rule';\r\nimport { Starter } from './starter';\r\n\r\nexport const ViewerExtensions = [Starter, HorizontalRule];\r\n"
    },
    {
      "path": "lib/utils.ts",
      "content": "import { clsx, type ClassValue } from 'clsx';\r\nimport { twMerge } from 'tailwind-merge';\r\n\r\nexport function cn(...inputs: ClassValue[]) {\r\n\treturn twMerge(clsx(inputs));\r\n}\r\n"
    },
    {
      "path": "styles/base.css",
      "content": ".notra-editor {\n\twhite-space: pre-wrap;\n\toutline: none;\n\tcolor: var(--notra-text);\n}\n\n.notra-editor > * {\n\tposition: relative;\n}\n"
    },
    {
      "path": "styles/blockquote.css",
      "content": ".notra-editor {\n\tblockquote {\n\t\tposition: relative;\n\t\tpadding-left: 1em;\n\t\tpadding-top: 0.375em;\n\t\tpadding-bottom: 0.375em;\n\t\tmargin: 1.5rem 0;\n\n\t\tp {\n\t\t\tmargin-top: 0;\n\t\t}\n\n\t\t/* Decorative left bar via pseudo-element */\n\t\t&::before {\n\t\t\tposition: absolute;\n\t\t\tbottom: 0;\n\t\t\tleft: 0;\n\t\t\ttop: 0;\n\t\t\theight: 100%;\n\t\t\twidth: 0.25em;\n\t\t\tbackground-color: var(--notra-blockquote-bar);\n\t\t\tcontent: '';\n\t\t}\n\t}\n}\n"
    },
    {
      "path": "styles/code.css",
      "content": ".notra-editor {\n\tcode {\n\t\tbackground-color: var(--notra-code-bg);\n\t\tcolor: var(--notra-code-text);\n\t\tborder: 1px solid var(--notra-code-border);\n\t\tfont-family:\n\t\t\tui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, monospace;\n\t\tfont-size: 0.875em;\n\t\tline-height: 1.4;\n\t\tborder-radius: 0.375rem;\n\t\tpadding: 0.1em 0.2em;\n\t}\n\n\tpre {\n\t\tbackground-color: var(--notra-codeblock-bg);\n\t\tcolor: var(--notra-codeblock-text);\n\t\tborder: 1px solid var(--notra-codeblock-border);\n\t\tmargin-top: 1.5em;\n\t\tmargin-bottom: 1.5em;\n\t\tpadding: 1em;\n\t\tfont-size: 1rem;\n\t\tborder-radius: 0.375rem;\n\t\toverflow-x: auto;\n\n\t\tcode {\n\t\t\tbackground-color: transparent;\n\t\t\tborder: none;\n\t\t\tborder-radius: 0;\n\t\t\tcolor: inherit;\n\t\t\tpadding: 0;\n\t\t}\n\t}\n}\n"
    },
    {
      "path": "styles/editor.css",
      "content": "@import './variables.css';\n@import './base.css';\n@import './heading.css';\n@import './text.css';\n@import './list.css';\n@import './code.css';\n@import './blockquote.css';\n@import './horizontal-rule.css';\n@import './image.css';\n"
    },
    {
      "path": "styles/heading.css",
      "content": "/* Vertical rhythm values from Tailwind Typography */\n.notra-editor {\n\th1,\n\th2,\n\th3,\n\th4 {\n\t\tposition: relative;\n\t\tcolor: inherit;\n\t\tfont-style: inherit;\n\n\t\t&:first-child {\n\t\t\tmargin-top: 0;\n\t\t}\n\t}\n\n\th1 {\n\t\tmargin-top: 0;\n\t\tmargin-bottom: 0.888889em;\n\t\tfont-size: 2.25em;\n\t\tfont-weight: 700;\n\t\tline-height: 1.11111;\n\t}\n\n\th2 {\n\t\tmargin-top: 2em;\n\t\tmargin-bottom: 1em;\n\t\tfont-size: 1.5em;\n\t\tfont-weight: 700;\n\t\tline-height: 1.33333;\n\t}\n\n\th3 {\n\t\tmargin-top: 1.6em;\n\t\tmargin-bottom: 0.6em;\n\t\tfont-size: 1.25em;\n\t\tfont-weight: 600;\n\t\tline-height: 1.6;\n\t}\n\n\th4 {\n\t\tmargin-top: 1.5em;\n\t\tmargin-bottom: 0.5em;\n\t\tfont-weight: 600;\n\t\tline-height: 1.5;\n\t}\n}\n"
    },
    {
      "path": "styles/horizontal-rule.css",
      "content": ".notra-editor {\n\thr {\n\t\tborder: none;\n\t\theight: 1px;\n\t\tbackground-color: var(--notra-hr);\n\t\tmargin-top: 2.25em;\n\t\tmargin-bottom: 2.25em;\n\t}\n}\n"
    },
    {
      "path": "styles/image.css",
      "content": ".notra-editor {\n\timg {\n\t\tmax-width: 100%;\n\t\theight: auto;\n\t\tdisplay: block;\n\t\tmargin: 2rem 0;\n\t\tborder-radius: 0.25rem;\n\t}\n}\n"
    },
    {
      "path": "styles/list.css",
      "content": ".notra-editor {\n\tol,\n\tul {\n\t\tmargin-top: 1.5em;\n\t\tmargin-bottom: 1.5em;\n\t\tpadding-left: 1.5em;\n\n\t\t&:first-child {\n\t\t\tmargin-top: 0;\n\t\t}\n\n\t\t&:last-child {\n\t\t\tmargin-bottom: 0;\n\t\t}\n\n\t\tol,\n\t\tul {\n\t\t\tmargin-top: 0;\n\t\t\tmargin-bottom: 0;\n\t\t}\n\t}\n\n\tli {\n\t\tp {\n\t\t\tmargin-top: 0;\n\t\t\tline-height: 1.6;\n\t\t}\n\t}\n\n\tol {\n\t\tlist-style: decimal;\n\n\t\tol {\n\t\t\tlist-style: lower-alpha;\n\n\t\t\tol {\n\t\t\t\tlist-style: lower-roman;\n\t\t\t}\n\t\t}\n\t}\n\n\tul {\n\t\tlist-style: disc;\n\n\t\tul {\n\t\t\tlist-style: circle;\n\n\t\t\tul {\n\t\t\t\tlist-style: square;\n\t\t\t}\n\t\t}\n\t}\n}\n"
    },
    {
      "path": "styles/text.css",
      "content": ".notra-editor {\n\tp:not(:first-child) {\n\t\tfont-size: 1rem;\n\t\tline-height: 1.6;\n\t\tfont-weight: normal;\n\t\tmargin-top: 1.25em;\n\t}\n\n\tstrong {\n\t\tfont-weight: 700;\n\t}\n\n\tem {\n\t\tfont-style: italic;\n\t}\n\n\ta {\n\t\tcolor: var(--notra-link);\n\t\ttext-decoration: underline;\n\t}\n\n\ta span {\n\t\ttext-decoration: underline;\n\t}\n\n\ts span {\n\t\ttext-decoration: line-through;\n\t}\n\n\tu span {\n\t\ttext-decoration: underline;\n\t}\n}\n"
    },
    {
      "path": "styles/variables.css",
      "content": "/* Palette - override these to change the theme */\n.notra-editor {\n\t/* Gray alpha scale */\n\t--notra-gray-a-50: rgb(56 56 56 / 4%);\n\t--notra-gray-a-100: rgb(15 22 36 / 5%);\n\t--notra-gray-a-200: rgb(37 39 45 / 10%);\n\t--notra-gray-a-300: rgb(47 50 55 / 20%);\n\t--notra-gray-a-400: rgb(40 44 51 / 42%);\n\t--notra-gray-a-500: rgb(52 55 60 / 64%);\n\t--notra-gray-a-600: rgb(36 39 46 / 78%);\n\t--notra-gray-a-700: rgb(35 37 42 / 87%);\n\t--notra-gray-a-800: rgb(30 32 36 / 95%);\n\t--notra-gray-a-900: rgb(29 30 32 / 98%);\n\n\t/* Brand */\n\t--notra-brand-50: rgb(239 238 255);\n\t--notra-brand-100: rgb(222 219 255);\n\t--notra-brand-200: rgb(195 189 255);\n\t--notra-brand-300: rgb(157 138 255);\n\t--notra-brand-400: rgb(122 82 255);\n\t--notra-brand-500: rgb(98 41 255);\n\t--notra-brand-600: rgb(84 0 229);\n\t--notra-brand-700: rgb(75 0 204);\n\t--notra-brand-800: rgb(56 0 153);\n\t--notra-brand-900: rgb(43 25 102);\n\t--notra-brand-950: hsl(257deg 100% 9%);\n\n\t/* Semantic tokens */\n\t--notra-text: var(--notra-gray-a-900);\n\t--notra-link: var(--notra-brand-500);\n\t--notra-code-bg: var(--notra-gray-a-100);\n\t--notra-code-text: var(--notra-gray-a-700);\n\t--notra-code-border: var(--notra-gray-a-200);\n\t--notra-codeblock-bg: var(--notra-gray-a-50);\n\t--notra-codeblock-text: var(--notra-gray-a-800);\n\t--notra-codeblock-border: var(--notra-gray-a-200);\n\t--notra-blockquote-bar: var(--notra-gray-a-900);\n\t--notra-hr: var(--notra-gray-a-200);\n}\n\n/* Dark mode via .dark ancestor or class on editor itself */\n.dark .notra-editor,\n.notra-editor.dark {\n\t--notra-gray-a-50: rgb(232 232 253 / 5%);\n\t--notra-gray-a-100: rgb(231 231 243 / 7%);\n\t--notra-gray-a-200: rgb(238 238 246 / 11%);\n\t--notra-gray-a-300: rgb(239 239 245 / 22%);\n\t--notra-gray-a-400: rgb(244 244 255 / 37%);\n\t--notra-gray-a-500: rgb(236 238 253 / 50%);\n\t--notra-gray-a-600: rgb(247 247 253 / 64%);\n\t--notra-gray-a-700: rgb(251 251 254 / 75%);\n\t--notra-gray-a-800: rgb(253 253 253 / 88%);\n\t--notra-gray-a-900: rgb(255 255 255 / 96%);\n\t--notra-link: var(--notra-brand-400);\n}\n\n/* Dark mode via system preference (opt-out with .light class) */\n@media (prefers-color-scheme: dark) {\n\t.notra-editor:not(.light) {\n\t\t--notra-gray-a-50: rgb(232 232 253 / 5%);\n\t\t--notra-gray-a-100: rgb(231 231 243 / 7%);\n\t\t--notra-gray-a-200: rgb(238 238 246 / 11%);\n\t\t--notra-gray-a-300: rgb(239 239 245 / 22%);\n\t\t--notra-gray-a-400: rgb(244 244 255 / 37%);\n\t\t--notra-gray-a-500: rgb(236 238 253 / 50%);\n\t\t--notra-gray-a-600: rgb(247 247 253 / 64%);\n\t\t--notra-gray-a-700: rgb(251 251 254 / 75%);\n\t\t--notra-gray-a-800: rgb(253 253 253 / 88%);\n\t\t--notra-gray-a-900: rgb(255 255 255 / 96%);\n\t\t--notra-link: var(--notra-brand-400);\n\t}\n}\n"
    },
    {
      "path": "ui/fixed-toolbar.tsx",
      "content": "import { UndoRedoButton } from './undo-redo-button';\r\nimport { cn } from '../lib/utils';\r\n\r\nexport interface FixedToolbarProps {\r\n\tclassName?: string;\r\n}\r\n\r\nexport function FixedToolbar({ className }: FixedToolbarProps) {\r\n\treturn (\r\n\t\t<div\r\n\t\t\tclassName={cn(\r\n\t\t\t\t'flex items-center gap-1 overflow-x-auto p-1 border-b',\r\n\t\t\t\tclassName\r\n\t\t\t)}\r\n\t\t>\r\n\t\t\t<UndoRedoButton action=\"undo\" />\r\n\t\t\t<UndoRedoButton action=\"redo\" />\r\n\t\t</div>\r\n\t);\r\n}\r\n"
    },
    {
      "path": "ui/primitives/button.tsx",
      "content": "import { Slot } from '@radix-ui/react-slot';\r\nimport { cva, type VariantProps } from 'class-variance-authority';\r\nimport * as React from 'react';\r\n\r\nimport { cn } from '../../lib/utils';\r\n\r\nconst buttonVariants = cva(\r\n\t\"inline-flex shrink-0 cursor-pointer items-center justify-center gap-2 rounded-md text-sm font-medium whitespace-nowrap transition-all outline-none focus-visible:border-ring focus-visible:ring-[3px] focus-visible:ring-ring/50 disabled:pointer-events-none disabled:opacity-50 aria-invalid:border-destructive aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4\",\r\n\t{\r\n\t\tvariants: {\r\n\t\t\tvariant: {\r\n\t\t\t\tdefault:\r\n\t\t\t\t\t'bg-primary text-primary-foreground shadow-xs hover:bg-primary/90',\r\n\t\t\t\tdestructive:\r\n\t\t\t\t\t'bg-destructive text-white shadow-xs hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:bg-destructive/60 dark:focus-visible:ring-destructive/40',\r\n\t\t\t\toutline:\r\n\t\t\t\t\t'border bg-background shadow-xs hover:bg-accent hover:text-accent-foreground dark:border-input dark:bg-input/30 dark:hover:bg-input/50',\r\n\t\t\t\tsecondary:\r\n\t\t\t\t\t'bg-secondary text-secondary-foreground shadow-xs hover:bg-secondary/80',\r\n\t\t\t\tghost:\r\n\t\t\t\t\t'hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50',\r\n\t\t\t\tlink: 'text-primary underline-offset-4 hover:underline'\r\n\t\t\t},\r\n\t\t\tsize: {\r\n\t\t\t\tdefault: 'h-9 px-4 py-2 has-[>svg]:px-3',\r\n\t\t\t\tsm: 'h-8 gap-1.5 rounded-md px-3 has-[>svg]:px-2.5',\r\n\t\t\t\tlg: 'h-10 rounded-md px-6 has-[>svg]:px-4',\r\n\t\t\t\ticon: 'size-7',\r\n\t\t\t\txs: 'h-7 gap-0 px-1.5'\r\n\t\t\t},\r\n\t\t\tisActive: {\r\n\t\t\t\ttrue: 'bg-accent text-accent-foreground dark:bg-accent/50'\r\n\t\t\t}\r\n\t\t},\r\n\t\tdefaultVariants: {\r\n\t\t\tvariant: 'default',\r\n\t\t\tsize: 'default'\r\n\t\t}\r\n\t}\r\n);\r\n\r\nfunction Button({\r\n\tclassName,\r\n\tvariant,\r\n\tsize,\r\n\tasChild = false,\r\n\tisActive = false,\r\n\t...props\r\n}: Readonly<React.ComponentProps<'button'>> &\r\n\tVariantProps<typeof buttonVariants> & {\r\n\t\tasChild?: boolean;\r\n\t}) {\r\n\tconst Comp = asChild ? Slot : 'button';\r\n\r\n\treturn (\r\n\t\t<Comp\r\n\t\t\tclassName={cn(buttonVariants({ variant, size, className, isActive }))}\r\n\t\t\tdata-slot=\"button\"\r\n\t\t\t{...props}\r\n\t\t/>\r\n\t);\r\n}\r\n\r\nexport { Button, buttonVariants };\r\n"
    },
    {
      "path": "ui/undo-redo-button.tsx",
      "content": "import { useCurrentEditor } from '@tiptap/react';\r\nimport { Redo2, Undo2 } from 'lucide-react';\r\n\r\nimport { Button } from './primitives/button';\r\n\r\nimport type { Editor } from '@tiptap/core';\r\n\r\nexport interface UndoRedoButtonProps {\r\n\taction: 'undo' | 'redo';\r\n}\r\n\r\nexport function canExecuteAction(\r\n\teditor: Editor | null,\r\n\taction: 'undo' | 'redo'\r\n): boolean {\r\n\tif (!editor || !editor.isEditable) return false;\r\n\r\n\treturn action === 'undo' ? editor.can().undo() : editor.can().redo();\r\n}\r\n\r\nexport function executeAction(\r\n\teditor: Editor | null,\r\n\taction: 'undo' | 'redo'\r\n): boolean {\r\n\tif (!editor || !canExecuteAction(editor, action)) return false;\r\n\r\n\tconst chain = editor.chain().focus();\r\n\r\n\treturn action === 'undo' ? chain.undo().run() : chain.redo().run();\r\n}\r\n\r\nexport function UndoRedoButton({ action }: UndoRedoButtonProps) {\r\n\tconst { editor } = useCurrentEditor();\r\n\tconst canExecute = canExecuteAction(editor, action);\r\n\tconst Icon = action === 'undo' ? Undo2 : Redo2;\r\n\r\n\treturn (\r\n\t\t<Button\r\n\t\t\tdisabled={!canExecute}\r\n\t\t\tsize=\"icon\"\r\n\t\t\tvariant=\"ghost\"\r\n\t\t\tonClick={() => executeAction(editor, action)}\r\n\t\t>\r\n\t\t\t<Icon size={16} />\r\n\t\t</Button>\r\n\t);\r\n}\r\n"
    },
    {
      "path": "ui/__tests__/undo-redo-button.test.ts",
      "content": "import * as fc from 'fast-check';\r\nimport { describe, expect, test, vi } from 'vitest';\r\n\r\nimport { canExecuteAction, executeAction } from '../undo-redo-button';\r\n\r\n// Minimal mock that satisfies the subset of Editor used by canExecuteAction\r\ninterface MockEditor {\r\n\tisEditable: boolean;\r\n\tcan: () => { undo: () => boolean; redo: () => boolean };\r\n}\r\n\r\ntype EditorState =\r\n\t| { type: 'null' }\r\n\t| { type: 'not-editable' }\r\n\t| { type: 'editable'; canUndo: boolean; canRedo: boolean };\r\n\r\nconst editorStateArbitrary: fc.Arbitrary<EditorState> = fc.oneof(\r\n\tfc.constant<EditorState>({ type: 'null' }),\r\n\tfc.constant<EditorState>({ type: 'not-editable' }),\r\n\tfc.record<EditorState & { type: 'editable' }>({\r\n\t\ttype: fc.constant('editable' as const),\r\n\t\tcanUndo: fc.boolean(),\r\n\t\tcanRedo: fc.boolean()\r\n\t})\r\n);\r\n\r\nconst actionArbitrary: fc.Arbitrary<'undo' | 'redo'> = fc.constantFrom(\r\n\t'undo' as const,\r\n\t'redo' as const\r\n);\r\n\r\nfunction buildMockEditor(state: EditorState): MockEditor | null {\r\n\tif (state.type === 'null') return null;\r\n\r\n\tif (state.type === 'not-editable') {\r\n\t\treturn {\r\n\t\t\tisEditable: false,\r\n\t\t\tcan: () => ({ undo: () => false, redo: () => false })\r\n\t\t};\r\n\t}\r\n\r\n\treturn {\r\n\t\tisEditable: true,\r\n\t\tcan: () => ({\r\n\t\t\tundo: () => state.canUndo,\r\n\t\t\tredo: () => state.canRedo\r\n\t\t})\r\n\t};\r\n}\r\n\r\nfunction expectedResult(state: EditorState, action: 'undo' | 'redo'): boolean {\r\n\tif (state.type === 'null' || state.type === 'not-editable') return false;\r\n\r\n\treturn action === 'undo' ? state.canUndo : state.canRedo;\r\n}\r\n\r\ndescribe('Feature: fixed-toolbar, Property 1: canExecuteAction 正确反映编辑器能力', () => {\r\n\t/**\r\n\t * **Validates: Requirements 3.7, 3.8, 4.3**\r\n\t */\r\n\ttest('Property 1: canExecuteAction returns true iff editor is non-null, editable, and has matching history', () => {\r\n\t\tfc.assert(\r\n\t\t\tfc.property(editorStateArbitrary, actionArbitrary, (state, action) => {\r\n\t\t\t\tconst editor = buildMockEditor(state);\r\n\t\t\t\t// Cast to satisfy the Editor type parameter without importing the full Tiptap dependency\r\n\t\t\t\tconst result = canExecuteAction(editor as never, action);\r\n\r\n\t\t\t\texpect(result).toBe(expectedResult(state, action));\r\n\t\t\t}),\r\n\t\t\t{ numRuns: 100 }\r\n\t\t);\r\n\t});\r\n});\r\n\r\n// Extended mock that also tracks chain().focus().undo()/redo().run() calls\r\ninterface MockEditorWithChain {\r\n\tisEditable: boolean;\r\n\tcan: () => { undo: () => boolean; redo: () => boolean };\r\n\tchain: () => {\r\n\t\tfocus: () => {\r\n\t\t\tundo: () => { run: () => boolean };\r\n\t\t\tredo: () => { run: () => boolean };\r\n\t\t};\r\n\t};\r\n}\r\n\r\nfunction buildMockEditorWithChain(state: EditorState): {\r\n\teditor: MockEditorWithChain | null;\r\n\tspies: { undo: ReturnType<typeof vi.fn>; redo: ReturnType<typeof vi.fn> };\r\n} {\r\n\tconst undoRunSpy = vi.fn(() => true);\r\n\tconst redoRunSpy = vi.fn(() => true);\r\n\tconst spies = { undo: undoRunSpy, redo: redoRunSpy };\r\n\r\n\tif (state.type === 'null') return { editor: null, spies };\r\n\r\n\tif (state.type === 'not-editable') {\r\n\t\treturn {\r\n\t\t\teditor: {\r\n\t\t\t\tisEditable: false,\r\n\t\t\t\tcan: () => ({ undo: () => false, redo: () => false }),\r\n\t\t\t\tchain: () => ({\r\n\t\t\t\t\tfocus: () => ({\r\n\t\t\t\t\t\tundo: () => ({ run: undoRunSpy }),\r\n\t\t\t\t\t\tredo: () => ({ run: redoRunSpy })\r\n\t\t\t\t\t})\r\n\t\t\t\t})\r\n\t\t\t},\r\n\t\t\tspies\r\n\t\t};\r\n\t}\r\n\r\n\treturn {\r\n\t\teditor: {\r\n\t\t\tisEditable: true,\r\n\t\t\tcan: () => ({\r\n\t\t\t\tundo: () => state.canUndo,\r\n\t\t\t\tredo: () => state.canRedo\r\n\t\t\t}),\r\n\t\t\tchain: () => ({\r\n\t\t\t\tfocus: () => ({\r\n\t\t\t\t\tundo: () => ({ run: undoRunSpy }),\r\n\t\t\t\t\tredo: () => ({ run: redoRunSpy })\r\n\t\t\t\t})\r\n\t\t\t})\r\n\t\t},\r\n\t\tspies\r\n\t};\r\n}\r\n\r\ndescribe('Feature: fixed-toolbar, Property 2: executeAction 安全性', () => {\r\n\t/**\r\n\t * **Validates: Requirements 3.5, 3.6**\r\n\t */\r\n\ttest('Property 2: when canExecuteAction is false, executeAction returns false and calls no commands', () => {\r\n\t\tfc.assert(\r\n\t\t\tfc.property(editorStateArbitrary, actionArbitrary, (state, action) => {\r\n\t\t\t\tconst { editor, spies } = buildMockEditorWithChain(state);\r\n\t\t\t\tconst canExecute = canExecuteAction(editor as never, action);\r\n\r\n\t\t\t\tif (!canExecute) {\r\n\t\t\t\t\tconst result = executeAction(editor as never, action);\r\n\r\n\t\t\t\t\texpect(result).toBe(false);\r\n\t\t\t\t\texpect(spies.undo).not.toHaveBeenCalled();\r\n\t\t\t\t\texpect(spies.redo).not.toHaveBeenCalled();\r\n\t\t\t\t}\r\n\t\t\t}),\r\n\t\t\t{ numRuns: 100 }\r\n\t\t);\r\n\t});\r\n\r\n\t/**\r\n\t * **Validates: Requirements 3.5, 3.6**\r\n\t */\r\n\ttest('Property 2: when canExecuteAction is true, executeAction calls the corresponding command', () => {\r\n\t\tfc.assert(\r\n\t\t\tfc.property(editorStateArbitrary, actionArbitrary, (state, action) => {\r\n\t\t\t\tconst { editor, spies } = buildMockEditorWithChain(state);\r\n\t\t\t\tconst canExecute = canExecuteAction(editor as never, action);\r\n\r\n\t\t\t\tif (canExecute) {\r\n\t\t\t\t\tconst result = executeAction(editor as never, action);\r\n\r\n\t\t\t\t\texpect(result).toBe(true);\r\n\r\n\t\t\t\t\tif (action === 'undo') {\r\n\t\t\t\t\t\texpect(spies.undo).toHaveBeenCalledOnce();\r\n\t\t\t\t\t\texpect(spies.redo).not.toHaveBeenCalled();\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\texpect(spies.redo).toHaveBeenCalledOnce();\r\n\t\t\t\t\t\texpect(spies.undo).not.toHaveBeenCalled();\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}),\r\n\t\t\t{ numRuns: 100 }\r\n\t\t);\r\n\t});\r\n});\r\n"
    },
    {
      "path": "vitest.config.ts",
      "content": "import { defineConfig } from 'vitest/config';\r\n\r\nexport default defineConfig({\r\n\ttest: {\r\n\t\tinclude: ['ui/__tests__/**/*.test.ts'],\r\n\t\ttestTimeout: 30000\r\n\t}\r\n});\r\n"
    }
  ],
  "dependencies": [
    {
      "name": "@radix-ui/react-slot",
      "version": "1.2.3"
    },
    {
      "name": "@tiptap/core",
      "version": "3.19.0"
    },
    {
      "name": "@tiptap/extension-horizontal-rule",
      "version": "3.19.0"
    },
    {
      "name": "@tiptap/pm",
      "version": "3.19.0"
    },
    {
      "name": "@tiptap/react",
      "version": "3.19.0"
    },
    {
      "name": "@tiptap/starter-kit",
      "version": "3.19.0"
    },
    {
      "name": "@tiptap/static-renderer",
      "version": "3.19.0"
    },
    {
      "name": "class-variance-authority",
      "version": "0.7.1"
    },
    {
      "name": "clsx",
      "version": "2.1.1"
    },
    {
      "name": "lucide-react",
      "version": "0.511.0"
    },
    {
      "name": "tailwind-merge",
      "version": "3.3.0"
    }
  ]
}